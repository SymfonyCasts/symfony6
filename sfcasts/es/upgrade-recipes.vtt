WEBVTT

00:00:01.076 --> 00:00:04.736 align:middle
Cuando instalamos paquetes, muchos
de ellos tienen recetas Flex.

00:00:04.946 --> 00:00:08.586 align:middle
Éstas añaden nuevos archivos y
a veces modifican los existentes.

00:00:08.986 --> 00:00:12.036 align:middle
Hacen todo lo necesario para que
el paquete funcione inmediatamente.

00:00:12.456 --> 00:00:13.516 align:middle
Eso me encanta

00:00:14.056 --> 00:00:17.446 align:middle
Y, con el tiempo, estas
recetas tienden a cambiar.

00:00:17.796 --> 00:00:22.806 align:middle
Quizá decidan añadir una nueva línea a un archivo
de configuración o cambiar un valor por defecto.

00:00:22.806 --> 00:00:26.596 align:middle
Afortunadamente, Flex tiene un elegante
sistema de actualización de recetas.

00:00:26.936 --> 00:00:29.346 align:middle
Y aunque no es necesario que
actualices tus recetas, es

00:00:29.436 --> 00:00:32.826 align:middle
una forma estupenda de mantener el aspecto y
la sensación de modernidad de tu aplicación.

00:00:33.486 --> 00:00:36.966 align:middle
Las actualizaciones también ayudarán a solucionar
algunas de las advertencias de desaprobación que vimos al

00:00:36.966 --> 00:00:38.576 align:middle
final del capítulo anterior.

00:00:39.326 --> 00:00:43.696 align:middle
Antes de empezar, asegúrate de haber confirmado
los cambios en git -yo ya lo he hecho-

00:00:43.946 --> 00:00:46.796 align:middle
porque el sistema de actualización
de recetas funciona a través de Git.

00:00:47.656 --> 00:00:51.396 align:middle
Para ver las recetas, ejecuta:
composer recipes ¡Genial!

00:00:51.396 --> 00:00:53.766 align:middle
Parece que tenemos unas 8 actualizaciones.

00:00:54.226 --> 00:00:59.596 align:middle
Así que manos a la obra: composer
recipes:update ¿Actualizar recetas?

00:00:59.916 --> 00:01:04.786 align:middle
Sí, es una de mis cosas favoritas:
nos da la oportunidad de echar un

00:01:04.786 --> 00:01:07.566 align:middle
vistazo a lo que ha estado
cambiando en estos paquetes...

00:01:07.786 --> 00:01:11.026 align:middle
mientras hemos estado ocupados, ya sabes,
haciendo nuestro verdadero trabajo.

00:01:11.656 --> 00:01:14.006 align:middle
Pulsaré intro para ir bajando
por la lista uno a uno.

00:01:14.006 --> 00:01:18.416 align:middle
El primero es Doctrine Bundle: y
es una actualización compleja.

00:01:18.896 --> 00:01:20.356 align:middle
¡Incluso ha provocado un conflicto!

00:01:21.126 --> 00:01:25.986 align:middle
A veces podemos ver que la actualización de una receta
cambia algo -como la actualización de una línea

00:01:25.986 --> 00:01:29.276 align:middle
en un archivo de configuración-,
pero no entendemos muy bien por qué.

00:01:29.986 --> 00:01:34.836 align:middle
Para ayudarnos, el comando enumera todas las
peticiones pull que hay detrás de estos cambios.

00:01:34.836 --> 00:01:37.836 align:middle
Por ejemplo, esto de los fantasmas perezosos...

00:01:38.216 --> 00:01:41.646 align:middle
podemos hacer clic en el enlace para ver
el PR y la explicación que hay detrás.

00:01:42.686 --> 00:01:45.096 align:middle
De vuelta en mi editor, ¡woh!

00:01:45.556 --> 00:01:48.366 align:middle
¡Supongo que el conflicto
estaba en doctrine.yaml!

00:01:48.756 --> 00:01:51.436 align:middle
Concretamente, server_version cambió.

00:01:52.116 --> 00:01:55.726 align:middle
La receta original nos daba una
configuración para trabajar con Postgres 13.

00:01:56.236 --> 00:01:59.166 align:middle
Ahora viene con código para Postgres 16.

00:01:59.916 --> 00:02:01.726 align:middle
No necesitas mantener los nuevos cambios.

00:02:01.726 --> 00:02:05.976 align:middle
Si tu base de datos de producción
utiliza Postgres 13, ¡consérvala!

00:02:06.356 --> 00:02:08.116 align:middle
Pero yo actualizaré a 16.

00:02:08.116 --> 00:02:16.296 align:middle
En el terminal, ejecuta: git status
Añade ese archivo a git para resolverlo.

00:02:16.726 --> 00:02:23.276 align:middle
Luego mira todos los cambios con: git diff
--cached La mayoría son cambios de versión:

00:02:23.716 --> 00:02:28.536 align:middle
MySQL de 5.7 a 8 y Postgres de 13 a 16.

00:02:29.316 --> 00:02:32.626 align:middle
La configuración de doctrine.yaml
tiene algunas líneas nuevas.

00:02:33.126 --> 00:02:37.696 align:middle
Son banderas en las que estamos optando por
algún cambio de bajo nivel en el sistema.

00:02:38.426 --> 00:02:42.716 align:middle
Y es muy probable que no tener esta
configuración provoque una depreciación.

00:02:43.386 --> 00:02:48.196 align:middle
Te dejaré que profundices en ellas si te
interesa, pero probablemente no afecten a nada.

00:02:48.996 --> 00:02:53.646 align:middle
docker-compose.yaml contiene más
cambios que van de Postgres 13 a 16.

00:02:53.646 --> 00:02:58.146 align:middle
Así que, de nuevo, puedes
conservarlas o deshacerte de ellas.

00:02:58.146 --> 00:03:01.936 align:middle
Y luego, al acecho en la parte inferior,
symfony.lock hace un seguimiento de

00:03:01.936 --> 00:03:04.666 align:middle
qué versión de la receta tenemos instalada.

00:03:04.666 --> 00:03:06.226 align:middle
Así que, ¡ya está!

00:03:06.726 --> 00:03:07.776 align:middle
Confirma estos cambios...

00:03:08.096 --> 00:03:10.966 align:middle
y utiliza un mensaje de
confirmación mejor que el mío.

00:03:11.696 --> 00:03:15.326 align:middle
Para utilizar la nueva versión de
Postgres de docker-compose.yaml, ejecuta:

00:03:15.456 --> 00:03:22.926 align:middle
docker compose down Luego docker compose up
-d Ahora tenemos Postgres 16 en ejecución.

00:03:24.116 --> 00:03:28.576 align:middle
Observa: la página de inicio sigue funcionando
porque no habla con la base de datos.

00:03:28.986 --> 00:03:32.066 align:middle
Pero cuando hacemos clic en
"examinar mezclas", ¡rompido!

00:03:32.566 --> 00:03:35.746 align:middle
Una tabla indefinida porque estamos
utilizando una base de datos nueva.

00:03:35.836 --> 00:03:41.666 align:middle
Arréglalo ejecutando: symfony console
doctrine:migrations:migrate Genial.

00:03:42.216 --> 00:03:47.096 align:middle
Y symfony console
doctrine:fixtures:load Doble guay.

00:03:47.956 --> 00:03:49.776 align:middle
Ahora... ¡ya estamos!

00:03:50.586 --> 00:03:51.416 align:middle
De vuelta al terminal...

00:03:51.416 --> 00:03:57.656 align:middle
y de vuelta al trabajo: composer recipes:update
En cubierta está doctrine-migrations-bundle.

00:03:58.186 --> 00:03:59.606 align:middle
Esto es menor.

00:04:00.116 --> 00:04:05.876 align:middle
El bundle viene con una integración del perfilador: es este
pequeño icono en la barra de herramientas de depuración web.

00:04:06.656 --> 00:04:08.236 align:middle
No es superútil...

00:04:08.386 --> 00:04:11.676 align:middle
y por eso se ha cambiado para que
no esté activado por defecto.

00:04:12.456 --> 00:04:13.206 align:middle
Vamos a confirmar eso...

00:04:13.656 --> 00:04:15.646 align:middle
y actualicemos el siguiente.

00:04:15.646 --> 00:04:17.126 align:middle
¡Framework bundle!

00:04:17.426 --> 00:04:18.836 align:middle
¡El núcleo de Symfony!

00:04:19.486 --> 00:04:22.506 align:middle
Ejecuta git diff --cached para ver los cambios.

00:04:23.256 --> 00:04:28.396 align:middle
Al igual que Doctrine, la mayoría son de bajo nivel,
en los que optamos por un nuevo comportamiento.

00:04:28.396 --> 00:04:34.276 align:middle
Por ejemplo, las anotaciones están
obsoletas, así que las desactivamos.

00:04:34.276 --> 00:04:38.126 align:middle
handle_all_throwables significa que
Symfony transformará las excepciones

00:04:38.126 --> 00:04:41.546 align:middle
en páginas de error, pero
también otros tipos de errores.

00:04:42.256 --> 00:04:46.356 align:middle
Y storage_factory_id se ha eliminado
porque es el valor por defecto.

00:04:46.966 --> 00:04:48.636 align:middle
¡Fácil! Confirma eso...

00:04:49.416 --> 00:04:53.306 align:middle
y sigue adelante: Lo
siguiente es monolog-bundle.

00:04:53.306 --> 00:04:58.306 align:middle
El único cambio es una nueva clave
formatter al final de monolog.yaml.

00:04:59.026 --> 00:05:01.216 align:middle
Se trata de un cambio de coherencia.

00:05:01.826 --> 00:05:07.156 align:middle
Aquí abajo, en la configuración de prod, el gestor
de registro principal ya tiene esta clave formatter.

00:05:07.866 --> 00:05:11.496 align:middle
Se ha añadido en deprecations para
que todo tenga el mismo formato.

00:05:12.086 --> 00:05:13.276 align:middle
Menor, ¡pero bonito!

00:05:13.826 --> 00:05:16.116 align:middle
Pronto hablaremos más sobre
este registro de desaprobación.

00:05:16.116 --> 00:05:18.046 align:middle
Así que, ¡compromételo!

00:05:18.586 --> 00:05:20.706 align:middle
Y... Enrutamiento.

00:05:22.346 --> 00:05:23.096 align:middle
Muy sencillo.

00:05:23.516 --> 00:05:28.136 align:middle
El código que importa los atributos #[Route],
al parecer, necesita una clave namespace.

00:05:28.816 --> 00:05:30.406 align:middle
Da igual. Confirmado...

00:05:30.956 --> 00:05:33.966 align:middle
y a symfony/traducción.

00:05:34.546 --> 00:05:41.576 align:middle
Otra fácil: translation.yaml solía tener
algunos proveedores comentados como ejemplo...

00:05:41.926 --> 00:05:42.936 align:middle
y ahora ya no están.

00:05:43.506 --> 00:05:48.446 align:middle
Pero si instalas uno de estos paquetes de
proveedores, su receta volverá a añadir la línea.

00:05:50.116 --> 00:05:50.686 align:middle
Confirma eso...

00:05:52.276 --> 00:05:54.696 align:middle
¡y nos quedan las 2 últimas recetas!

00:05:55.256 --> 00:05:59.586 align:middle
Ambas están relacionadas con cambios en
Webpack Encore y un nuevo StimulusBundle.

00:06:00.156 --> 00:06:03.056 align:middle
Eso merece su propio capítulo,
¡así que hagámoslo a continuación!
